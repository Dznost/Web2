<%- include('../layouts/main') %>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-plus me-2"></i>
                        Thêm sách mới
                    </h4>
                </div>
                <div class="card-body">
                    <form id="addBookForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="bookId" class="form-label">
                                        <i class="fas fa-barcode me-1"></i>Mã sách *
                                    </label>
                                    <input type="text" class="form-control" id="bookId" name="bookId" required>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="title" class="form-label">
                                        <i class="fas fa-book me-1"></i>Tên sách *
                                    </label>
                                    <input type="text" class="form-control" id="title" name="title" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="author" class="form-label">
                                        <i class="fas fa-user me-1"></i>Tác giả *
                                    </label>
                                    <input type="text" class="form-control" id="author" name="author" required>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="year" class="form-label">
                                        <i class="fas fa-calendar me-1"></i>Năm xuất bản *
                                    </label>
                                    <input type="number" class="form-control" id="year" name="year" 
                                           min="1900" max="<%= new Date().getFullYear() %>" required>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="genre" class="form-label">
                                        <i class="fas fa-tag me-1"></i>Thể loại *
                                    </label>
                                    <input type="text" class="form-control" id="genre" name="genre" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="summary" class="form-label">
                                <i class="fas fa-align-left me-1"></i>Tóm tắt *
                            </label>
                            <textarea class="form-control" id="summary" name="summary" rows="4" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="image" class="form-label">
                                <i class="fas fa-image me-1"></i>Ảnh bìa sách
                            </label>
                            <input type="file" class="form-control" id="image" name="image" accept="image/*">
                            <div class="form-text">Chấp nhận file JPG, PNG. Tối đa 5MB.</div>
                        </div>
                        
                        <div class="card border-info mb-3">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-warehouse me-2"></i>
                                    Phân bố theo chi nhánh
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="branchA" class="form-label">Chi nhánh A</label>
                                            <input type="number" class="form-control" id="branchA" name="branchA" 
                                                   min="0" value="0">
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="branchB" class="form-label">Chi nhánh B</label>
                                            <input type="number" class="form-control" id="branchB" name="branchB" 
                                                   min="0" value="0">
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="branchC" class="form-label">Chi nhánh C</label>
                                            <input type="number" class="form-control" id="branchC" name="branchC" 
                                                   min="0" value="0">
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="branchD" class="form-label">Chi nhánh D</label>
                                            <input type="number" class="form-control" id="branchD" name="branchD" 
                                                   min="0" value="0">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info mb-0">
                                    <small>
                                        <i class="fas fa-info-circle me-1"></i>
                                        Tổng số sách: <span id="totalBooks">0</span> quyển
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/admin/distribute" class="btn btn-secondary me-md-2">
                                <i class="fas fa-list me-1"></i>Danh sách sách
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Thêm sách
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Calculate total books
function updateTotal() {
    const branchA = parseInt(document.getElementById('branchA').value) || 0;
    const branchB = parseInt(document.getElementById('branchB').value) || 0;
    const branchC = parseInt(document.getElementById('branchC').value) || 0;
    const branchD = parseInt(document.getElementById('branchD').value) || 0;
    
    const total = branchA + branchB + branchC + branchD;
    document.getElementById('totalBooks').textContent = total;
}

// Add event listeners
document.getElementById('branchA').addEventListener('input', updateTotal);
document.getElementById('branchB').addEventListener('input', updateTotal);
document.getElementById('branchC').addEventListener('input', updateTotal);
document.getElementById('branchD').addEventListener('input', updateTotal);

// Form submission
document.getElementById('addBookForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    try {
        const response = await fetch('/admin/add-book', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert(result.message);
            this.reset();
            updateTotal();
        } else {
            alert(result.error || 'Có lỗi xảy ra');
        }
    } catch (error) {
        alert('Có lỗi xảy ra khi thêm sách');
    }
});
</script>
