<%- include('../layouts/main') %>

<div class="container mt-4 mb-5">
    <!-- Header Section -->
    <div class="request-header mb-5">
        <div class="text-center">
            <div class="request-icon-wrapper mb-3">
                <i class="fas fa-book-medical"></i>
            </div>
            <h1 class="request-title mb-2">Y√™u c·∫ßu s√°ch m·ªõi</h1>
            <p class="request-subtitle">Gi√∫p ch√∫ng t√¥i m·ªü r·ªông th∆∞ vi·ªán v·ªõi nh·ªØng ƒë·∫ßu s√°ch b·∫°n quan t√¢m</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-7">
            <!-- Info Card -->
            <div class="info-card mb-4">
                <div class="info-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div class="info-content">
                    <h5 class="info-title">Kh√¥ng t√¨m th·∫•y s√°ch b·∫°n c·∫ßn?</h5>
                    <p class="info-text">H√£y g·ª≠i y√™u c·∫ßu ƒë·ªÉ ch√∫ng t√¥i xem x√©t b·ªï sung v√†o th∆∞ vi·ªán. M·ªói y√™u c·∫ßu c·ªßa b·∫°n ƒë·ªÅu ƒë∆∞·ª£c ƒë√°nh gi√° cao!</p>
                </div>
            </div>

            <!-- Main Form Card -->
            <div class="form-card">
                <div class="form-card-header">
                    <i class="fas fa-edit"></i>
                    <h4>Th√¥ng tin s√°ch y√™u c·∫ßu</h4>
                </div>
                
                <div class="form-card-body">
                    <form id="bookRequestForm">
                        <!-- Book Title & Author -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-custom">
                                    <label for="title" class="form-label-custom">
                                        <i class="fas fa-book text-success me-2"></i>
                                        T√™n s√°ch
                                        <span class="required">*</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control-custom" 
                                        id="title" 
                                        name="title" 
                                        placeholder="Nh·∫≠p t√™n s√°ch..."
                                        required
                                    >
                                    <div class="input-hint">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Vui l√≤ng nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß c·ªßa s√°ch
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group-custom">
                                    <label for="author" class="form-label-custom">
                                        <i class="fas fa-user-edit text-success me-2"></i>
                                        T√°c gi·∫£
                                        <span class="required">*</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control-custom" 
                                        id="author" 
                                        name="author" 
                                        placeholder="Nh·∫≠p t√™n t√°c gi·∫£..."
                                        required
                                    >
                                    <div class="input-hint">
                                        <i class="fas fa-info-circle me-1"></i>
                                        T√™n t√°c gi·∫£ ho·∫∑c nh√≥m t√°c gi·∫£
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Year & Genre -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-custom">
                                    <label for="year" class="form-label-custom">
                                        <i class="fas fa-calendar-alt text-success me-2"></i>
                                        NƒÉm xu·∫•t b·∫£n
                                    </label>
                                    <input 
                                        type="number" 
                                        class="form-control-custom" 
                                        id="year" 
                                        name="year" 
                                        min="1900" 
                                        max="<%= new Date().getFullYear() %>"
                                        placeholder="V√≠ d·ª•: 2024"
                                    >
                                    <div class="input-hint">
                                        <i class="fas fa-info-circle me-1"></i>
                                        NƒÉm ph√°t h√†nh s√°ch (n·∫øu bi·∫øt)
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group-custom">
                                    <label for="genre" class="form-label-custom">
                                        <i class="fas fa-tags text-success me-2"></i>
                                        Th·ªÉ lo·∫°i
                                    </label>
                                    <select class="form-control-custom" id="genre" name="genre">
                                        <option value="">-- Ch·ªçn th·ªÉ lo·∫°i --</option>
                                        <option value="VƒÉn h·ªçc">üìö VƒÉn h·ªçc</option>
                                        <option value="Khoa h·ªçc">üî¨ Khoa h·ªçc</option>
                                        <option value="L·ªãch s·ª≠">üìú L·ªãch s·ª≠</option>
                                        <option value="Kinh t·∫ø">üíº Kinh t·∫ø</option>
                                        <option value="C√¥ng ngh·ªá">üíª C√¥ng ngh·ªá</option>
                                        <option value="T√¢m l√Ω">üß† T√¢m l√Ω</option>
                                        <option value="K·ªπ nƒÉng s·ªëng">üåü K·ªπ nƒÉng s·ªëng</option>
                                        <option value="Thi·∫øu nhi">üßí Thi·∫øu nhi</option>
                                        <option value="Ti·ªÉu thuy·∫øt">üìñ Ti·ªÉu thuy·∫øt</option>
                                        <option value="Kh√°c">üìã Kh√°c</option>
                                    </select>
                                    <div class="input-hint">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Ch·ªçn th·ªÉ lo·∫°i ph√π h·ª£p nh·∫•t
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Publisher & ISBN -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-custom">
                                    <label for="publisher" class="form-label-custom">
                                        <i class="fas fa-building text-success me-2"></i>
                                        Nh√† xu·∫•t b·∫£n
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control-custom" 
                                        id="publisher" 
                                        name="publisher" 
                                        placeholder="Nh√† xu·∫•t b·∫£n..."
                                    >
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group-custom">
                                    <label for="isbn" class="form-label-custom">
                                        <i class="fas fa-barcode text-success me-2"></i>
                                        ISBN
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control-custom" 
                                        id="isbn" 
                                        name="isbn" 
                                        placeholder="M√£ ISBN (n·∫øu c√≥)..."
                                    >
                                </div>
                            </div>
                        </div>

                        <!-- Summary -->
                        <div class="form-group-custom">
                            <label for="summary" class="form-label-custom">
                                <i class="fas fa-align-left text-success me-2"></i>
                                T√≥m t·∫Øt n·ªôi dung
                            </label>
                            <textarea 
                                class="form-control-custom" 
                                id="summary" 
                                name="summary" 
                                rows="4" 
                                placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ n·ªôi dung, ch·ªß ƒë·ªÅ c·ªßa cu·ªën s√°ch..."
                            ></textarea>
                            <div class="char-counter">
                                <span id="summaryCount">0</span>/500 k√Ω t·ª±
                            </div>
                        </div>

                        <!-- Reason -->
                        <div class="form-group-custom">
                            <label for="reason" class="form-label-custom">
                                <i class="fas fa-question-circle text-success me-2"></i>
                                L√Ω do y√™u c·∫ßu
                                <span class="required">*</span>
                            </label>
                            <textarea 
                                class="form-control-custom" 
                                id="reason" 
                                name="reason" 
                                rows="3" 
                                placeholder="V√¨ sao b·∫°n mu·ªën th∆∞ vi·ªán c√≥ cu·ªën s√°ch n√†y? S√°ch n√†y s·∫Ω h·ªØu √≠ch nh∆∞ th·∫ø n√†o?"
                                required
                            ></textarea>
                            <div class="char-counter">
                                <span id="reasonCount">0</span>/300 k√Ω t·ª±
                            </div>
                        </div>

                        <!-- Priority Level -->
                        <div class="form-group-custom">
                            <label class="form-label-custom">
                                <i class="fas fa-star text-success me-2"></i>
                                M·ª©c ƒë·ªô ∆∞u ti√™n
                            </label>
                            <div class="priority-options">
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="low" checked>
                                    <span class="priority-card priority-low">
                                        <i class="fas fa-circle"></i>
                                        <div class="priority-label">Th·∫•p</div>
                                        <div class="priority-desc">Tham kh·∫£o th√™m</div>
                                    </span>
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="medium">
                                    <span class="priority-card priority-medium">
                                        <i class="fas fa-circle"></i>
                                        <div class="priority-label">Trung b√¨nh</div>
                                        <div class="priority-desc">C·∫ßn cho h·ªçc t·∫≠p</div>
                                    </span>
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="high">
                                    <span class="priority-card priority-high">
                                        <i class="fas fa-circle"></i>
                                        <div class="priority-label">Cao</div>
                                        <div class="priority-desc">R·∫•t c·∫ßn thi·∫øt</div>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Notice Alert -->
                        <div class="notice-alert">
                            <div class="notice-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="notice-content">
                                <strong>Th·ªùi gian x·ª≠ l√Ω:</strong> Y√™u c·∫ßu c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c xem x√©t v√† ph·∫£n h·ªìi trong v√≤ng 7-10 ng√†y l√†m vi·ªác.
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="form-actions">
                            <a href="/books" class="btn-custom btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>
                                Quay l·∫°i
                            </a>
                            <button type="submit" class="btn-custom btn-primary" id="submitBtn">
                                <i class="fas fa-paper-plane me-2"></i>
                                G·ª≠i y√™u c·∫ßu
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tips Card -->
            <div class="tips-card mt-4">
                <div class="tips-header">
                    <i class="fas fa-lightbulb"></i>
                    <h5>M·∫πo ƒë·ªÉ y√™u c·∫ßu hi·ªáu qu·∫£</h5>
                </div>
                <div class="tips-body">
                    <div class="tip-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Cung c·∫•p th√¥ng tin chi ti·∫øt v√† ch√≠nh x√°c nh·∫•t c√≥ th·ªÉ</span>
                    </div>
                    <div class="tip-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Gi·∫£i th√≠ch r√µ l√Ω do t·∫°i sao s√°ch n√†y quan tr·ªçng v·ªõi b·∫°n</span>
                    </div>
                    <div class="tip-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Ki·ªÉm tra k·ªπ tr∆∞·ªõc khi g·ª≠i ƒë·ªÉ tr√°nh sai s√≥t</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content success-modal">
            <div class="modal-body text-center p-5">
                <div class="success-icon mb-4">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h4 class="mb-3">G·ª≠i y√™u c·∫ßu th√†nh c√¥ng!</h4>
                <p class="text-muted mb-4">
                    C·∫£m ∆°n b·∫°n ƒë√£ g·ª≠i y√™u c·∫ßu. Ch√∫ng t√¥i s·∫Ω xem x√©t v√† ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ.
                </p>
                <button type="button" class="btn-custom btn-primary" data-bs-dismiss="modal">
                    <i class="fas fa-check me-2"></i>ƒê√£ hi·ªÉu
                </button>
            </div>
        </div>
    </div>
</div>

<style>
/* Header Section */
.request-header {
    padding: 3rem 0;
    background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    border-radius: 20px;
    margin-bottom: 2rem;
}

.request-icon-wrapper {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #10b981, #059669);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.request-icon-wrapper i {
    font-size: 3rem;
    color: white;
}

.request-title {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, #059669, #10b981);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.request-subtitle {
    font-size: 1.1rem;
    color: #64748b;
}

/* Info Card */
.info-card {
    background: linear-gradient(135deg, #eff6ff, #dbeafe);
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
    border: 2px solid #bfdbfe;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.info-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.info-icon i {
    font-size: 1.8rem;
    color: white;
}

.info-content {
    flex: 1;
}

.info-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e40af;
    margin-bottom: 0.5rem;
}

.info-text {
    color: #475569;
    margin: 0;
    line-height: 1.6;
}

/* Form Card */
.form-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    border: 2px solid #e2e8f0;
}

.form-card-header {
    background: linear-gradient(135deg, #10b981, #059669);
    padding: 2rem;
    color: white;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.form-card-header i {
    font-size: 2rem;
}

.form-card-header h4 {
    margin: 0;
    font-weight: 700;
}

.form-card-body {
    padding: 2.5rem;
}

/* Form Groups */
.form-group-custom {
    margin-bottom: 2rem;
}

.form-label-custom {
    font-size: 0.95rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
}

.required {
    color: #ef4444;
    margin-left: 0.25rem;
}

.form-control-custom {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: #f8fafc;
}

.form-control-custom:focus {
    outline: none;
    border-color: #10b981;
    background: white;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
}

.form-control-custom::placeholder {
    color: #94a3b8;
}

.input-hint {
    font-size: 0.8rem;
    color: #64748b;
    margin-top: 0.5rem;
}

.char-counter {
    text-align: right;
    font-size: 0.85rem;
    color: #64748b;
    margin-top: 0.5rem;
}

/* Priority Options */
.priority-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.priority-option {
    cursor: pointer;
}

.priority-option input[type="radio"] {
    display: none;
}

.priority-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem 1rem;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    background: #f8fafc;
    transition: all 0.3s ease;
    text-align: center;
}

.priority-card i {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.priority-label {
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 0.25rem;
}

.priority-desc {
    font-size: 0.8rem;
    color: #64748b;
}

.priority-low {
    color: #6b7280;
}

.priority-medium {
    color: #f59e0b;
}

.priority-high {
    color: #ef4444;
}

.priority-option input[type="radio"]:checked ~ .priority-card {
    border-color: currentColor;
    background: white;
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.priority-option input[type="radio"]:checked ~ .priority-low {
    border-color: #6b7280;
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
}

.priority-option input[type="radio"]:checked ~ .priority-medium {
    border-color: #f59e0b;
    background: linear-gradient(135deg, #fef3c7, #fde68a);
}

.priority-option input[type="radio"]:checked ~ .priority-high {
    border-color: #ef4444;
    background: linear-gradient(135deg, #fee2e2, #fecaca);
}

/* Notice Alert */
.notice-alert {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    border-left: 4px solid #3b82f6;
}

.notice-icon {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.notice-icon i {
    font-size: 1.3rem;
    color: white;
}

.notice-content {
    flex: 1;
    color: #1e40af;
    line-height: 1.6;
}

/* Form Actions */
.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    padding-top: 1rem;
    border-top: 2px solid #e2e8f0;
}

.btn-custom {
    padding: 0.875rem 2rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    text-decoration: none;
}

.btn-primary {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
}

.btn-secondary {
    background: #e2e8f0;
    color: #475569;
}

.btn-secondary:hover {
    background: #cbd5e1;
    color: #1e293b;
}

/* Tips Card */
.tips-card {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid #fbbf24;
}

.tips-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    color: #92400e;
}

.tips-header i {
    font-size: 1.5rem;
}

.tips-header h5 {
    margin: 0;
    font-weight: 700;
}

.tips-body {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.tip-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: #78350f;
}

.tip-item i {
    color: #f59e0b;
    margin-top: 0.2rem;
    flex-shrink: 0;
}

/* Success Modal */
.success-modal .modal-content {
    border-radius: 20px;
    border: none;
}

.success-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.success-icon i {
    font-size: 3.5rem;
    color: #10b981;
}

/* Responsive */
@media (max-width: 767px) {
    .request-header {
        padding: 2rem 1rem;
    }
    
    .request-icon-wrapper {
        width: 80px;
        height: 80px;
    }
    
    .request-icon-wrapper i {
        font-size: 2.5rem;
    }
    
    .request-title {
        font-size: 2rem;
    }
    
    .form-card-body {
        padding: 1.5rem;
    }
    
    .priority-options {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn-custom {
        width: 100%;
        justify-content: center;
    }
    
    .info-card {
        flex-direction: column;
        text-align: center;
    }
}
</style>

<script>
// Character counters
document.getElementById('summary').addEventListener('input', function() {
    const count = this.value.length;
    document.getElementById('summaryCount').textContent = count;
    if (count > 500) {
        this.value = this.value.substring(0, 500);
        document.getElementById('summaryCount').textContent = 500;
    }
});

document.getElementById('reason').addEventListener('input', function() {
    const count = this.value.length;
    document.getElementById('reasonCount').textContent = count;
    if (count > 300) {
        this.value = this.value.substring(0, 300);
        document.getElementById('reasonCount').textContent = 300;
    }
});

// Form submission
document.getElementById('bookRequestForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    
    // Disable button and show loading
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ƒêang g·ª≠i...';
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    try {
        const response = await fetch('/user/request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Show success modal
            const modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();
            
            // Reset form
            this.reset();
            document.getElementById('summaryCount').textContent = '0';
            document.getElementById('reasonCount').textContent = '0';
        } else {
            alert('‚ùå ' + (result.error || 'C√≥ l·ªói x·∫£y ra'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‚ùå C√≥ l·ªói x·∫£y ra khi g·ª≠i y√™u c·∫ßu');
    } finally {
        // Re-enable button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
});
</script>